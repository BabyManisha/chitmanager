{% extends "site_layout.html" %}
{% load myfilter %}
{% block title %}{{customer_details.name}} details{% endblock %} 
{% block page_heading %} Details of {{customer_details.name}} {% endblock %}
{% block content %}

<button onclick="window.location='/customers/subscription?cid={{customer_details.id}}'">Add To Group</button>
<button onclick="window.location='/customers/history?id={{customer_details.id}}'">Transaction History</button>
<p/>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.4.2.min.js"></script>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
 <script>
$(function() {
$( "#datepicker" ).datepicker({ dateFormat: 'yy-mm-dd' });
});

function remove_subscription(id) {
	x = confirm('Are you sure you want to remove the subscription?')
	if (x) {
		window.location = '/groups/remove_subscription?return_to=customer&id='+id
	}
	else {
		return false;
	}
}
</script>
{% if group_list %} 
<form action='/customers/record_payment' method="post">
{% csrf_token %}
<input type='hidden' name='customer_id' value='{{ customer_details.id }}'/>
<table border="0">
<tr align='right'>
		<td> Payment Date: <input id='datepicker' name='payment_date' type='text'/>
	</tr>
<tr><td>
<table border="1" bordercolor=lightgray cellspacing=0 cellpadding=5>
	<tr>
		<th>&nbsp;</th>
		<th>Group Names</th>
		<th>Subscription</th>
		<th>Auction Amount</th>
		<th>Due</th>
		<th>Payment</th>
	</tr>
  {% for subscription in group_list %}
   <tr>
   		<td>
   		  {% if subscription.group.started %}
   		  &nbsp;
   		  {% else %}
		  <a href='#' onclick="remove_subscription({{subscription.id}})">
		    <img src='/static/remove.png' class='action_icon' tooltip='Delete Subscription'/>
		  </a>
		  {% endif %}
		</td>
		<td>{{subscription.group.name}}</td>
		<td><a href="/customers/group_activity?subscription_id={{ subscription.id }}&return_to=customer">{{subscription.id}}</a></td>
		<td>{{subscription.auction_amount|default:"-"}}</td>
		<td>{{due_amounts|get_item:subscription.id}}</td>
		<td><input name="payment_for_{{ subscription.id }}"/></td>
   </tr>
	{% endfor %}
	<tr>
		<td align='right' colspan='4'> <b>Total:</b> </td>
		<td> <b>{{total_due}}</b> </td>
		<td align='right' colspan='4'> <input name='payment_amount'/> </td>
	<tr>
</table>
	<tr align='right'>
		<td><button onclick="window.location='#">Record Payment</button> </td>
	<tr>
	
</table>
</form>
{% else %}
Not in any groups yet
{% endif %}
{% endblock %}
