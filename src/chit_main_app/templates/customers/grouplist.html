{% extends "site_layout.html" %}
{% load myfilter %}
{% block title %}{{customer_details.name}} details{% endblock %} 
{% block page_heading %} Details of {{customer_details.name}} {% endblock %}
{% block content %}

<button onclick="window.location='/customers/subscription?cid={{customer_details.id}}'">Add To Group</button>
<button onclick="window.location='/customers/history?id={{customer_details.id}}'">Transaction History</button>
<p/>
<script>
function remove_subscription(id) {
	x = confirm('Are you sure you want to remove the subscription?')
	if (x) {
		window.location = '/groups/remove_subscription?return_to=customer&id='+id
	}
	else {
		return false;
	}
}
</script>
{% if group_list %} 
<form action='/customers/record_payment' method="post">
{% csrf_token %}
<input type='hidden' name='customer_id' value='{{ customer_details.id }}'/>
Payment (Due:{{total_due}}): <input name='payment_amount'/> <button onclick="window.location='#">Record Payment</button>
<table border="1" bordercolor=lightgray cellspacing=0 cellpadding=5>
	<tr>
		<th>&nbsp;</th>
		<th>Group Names</th>
		<th>ID</th>
		<th>Auction Amount</th>
		<th>Due</th>
		<th>Payment</th>
	</tr>
  {% for subscription in group_list %}
   <tr>
   		<td>
   		  {% if subscription.group.started %}
   		  &nbsp;
   		  {% else %}
		  <a href='#' onclick="remove_subscription({{subscription.id}})">
		    <img src='/static/remove.png' class='action_icon'/>
		  </a>
		  {% endif %}
		</td>
		<td>{{subscription.group.name}}</td>
		<td><a href="/customers/group_activity?subscription_id={{ subscription.id }}&return_to=customer">{{subscription.id}}</a></td>
		<td>{{subscription.auction_amount|default:"-"}}</td>
		<td>{{due_amounts|get_item:subscription.id}}</td>
		<td><input name="payment_for_{{ subscription.id }}"/></td>
   </tr>
	{% endfor %}
</table>
</form>
{% else %}
Not in any groups yet
{% endif %}
{% endblock %}
